{% extends 'base.html' %}
{% load static %}
{% block context %}
    <link rel="stylesheet" href="{% static 'vendors/select2/css/select2.min.css' %}" type="text/css">

    {% include 'message.html' %}



    <div class="card thead-danger">
        <h3>تخصیص قطعه از انبار به پشتیبان</h3>


        {% csrf_token %}


        <div class="row">
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
            </div>

            <div class="col-lg-3 col-md-3 col-sm-10 col-xs-10">
                <label>نوع قطعه</label>
                <select onchange="getStore(this.value)" name="period" id="id_period" class="form-control">
                    <option value="1">کارتخوان</option>
                    <option value="2">صفحه کلید</option>


                </select>
            </div>
            <input type="hidden" value="1" id="StoreId" name="StoreId">
            <div class="col-lg-3 col-md-3 col-sm-10 col-xs-10">
                <label> نام پشتیبان</label>
                <select onchange="getStoretoTek(this.value)" name="tek" id="id_tek"
                        class="form-control form-control-bg">
                    <option value="-1">یک پشتیبان انتخاب کنید</option>
                    {% for owner in owners %}
                        <option {% if owner.id == posttek %}selected{% endif %}
                                value="{{ owner.id }}">{{ owner.name }} {{ owner.lname }}

                        </option>
                    {% endfor %}
                </select>
            </div>

        </div>
      <hr>
    </div>


    <div class="card">
        <div class="row">

            <div class="card-body col-lg-5 col-sm-5">
                <form action="" method="get">

                    <input onkeyup="myFunction()" type="text" name="search" id="id_search" class="form-control search-input" autocomplete="off"
                           placeholder="جستجوی قطعه">
                    <input type="submit" class="btn btn-primary" hidden>
                </form>
                <hr>
                <div class="table-responsive">
                    <table style="border: #0b0b0b" id="myTable" class="table table-striped">
                     <caption style="display: none">ارسال قطعه به تکنسین</caption>
                        <thead class="thead-danger">
                        <tr>

                            <th class="text-center" scope="col"><input type="checkbox" id="check_all"></th>
                            <th scope="col">ردیف</th>
                            <th scope="col">شماره سریال</th>



                        </tr>
                        </thead>
                        <tbody>
                        {% for g in masters %}
                            <tr id="tr{{ g.id }}">
                                <td class="align-middle text-center text-sm"><input type="checkbox" class="checkbox" data-id="{{ g.id }}">
                                <td>{{ forloop.counter }}</td>
                                <td style="font-size: 20px;">{{ g.serial }}</td>
                                {% if g.level == 0 %}
                          <td><img src="{% static '/assets/img/risk/work-started-icon.svg' %}" data-toggle="tooltip" title="در یک ماه گذشته خرابی نداشته" alt=""/> </td>
                       {% endif %}
                       {% if g.level == 1 %}
                            <td><img src="{% static '/assets/img/risk/low-risk-icon.svg' %}" data-toggle="tooltip" title="در یک ماه گذشته یکبار معیوب شد" alt=""/> </td>
                             {% endif %}
                                  {% if g.level == 2 %}
                            <td><img src="{% static '/assets/img/risk/medium-risk-icon.svg' %}" data-toggle="tooltip" title="در یک ماه گذشته دو بار معیوب شد" alt=""/> </td>
                            {% endif %}
                                              {% if g.level == 3 %}
                           <td><img src="{% static '/assets/img/risk/high-risk-alert-icon.svg' %}" data-toggle="tooltip" title="در یک ماه گذشته بیش از دو بار معیوب شد" alt=""/> </td>
                            {% endif %}



                                </td>


                            </tr>
                        {% endfor %}
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="card-body col-lg-2 col-sm-2">

                <br>
                <br>

                <br>
                <ul class="nav">
                    <li class="nav-item">
                        <a onclick="AddRow(1)" class="btn btn-success m-l-5" title="اضافه به لیست "
                           data-toggle="tooltip">تخصیص
                            <i data-feather="arrow-left-circle" aria-hidden="true"></i>
                        </a>
                    </li>
                </ul>
                &nbsp
                <ul class="nav">
                    <li class="nav-item">

                        <a onclick="RemoveRow(1)" class="btn btn-danger m-l-5" title="حذف از لیست"
                           data-toggle="tooltip">برگشت
                            <i  data-feather="arrow-right-circle" aria-hidden="true"></i>
                        </a>
                    </li>
                </ul>
   &nbsp
                        <ul class="nav">
                    <li class="nav-item">
                        <a onclick="AddGS()" class="btn nav-link bg-primary" title="در ناحیه نصب شد "
                           data-toggle="tooltip">
نصب برای دستگاه حذف رمز
                        </a>
                    </li>
                </ul>
                &nbsp
            </div>
            <div class="card-body col-lg-5 col-sm-5">
                <h6>لیست قطعات انتخاب شده <span id="countgs">({{ gslist.count }}مورد)</span></h6>

                <div class="table-responsive">
                    <table style="border: #0b0b0b" id="mytab2" class="table table-striped">
                     <caption style="display: none">ارسال تکنسین</caption>
                        <thead class="thead-primery">
                        <tr>

                            <th class="text-center" scope="col"><input type="checkbox" id="check_alldel"></th>

                            <th scope="col">ردیف </th>
                            <th scope="col">شماره سریال</th>



                        </tr>

                        </thead>
                        <tbody>
                        <input type="hidden" id="userId" value="{{ userID }}">
                        {% for g in gslist %}
                            <tr id="tr{{ g.id }}">
                                <td class="align-middle text-center text-sm"><input type="checkbox"
                                                                                    class="checkbox1"
                                                                                    data-id="{{ g.id }}">

                                </td>
                            </tr>
                        {% endfor %}
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        <hr>


    </div>
    </div>
    </div>
    </div>
    </div>
    </div></div>

{% endblock %}
{% block script %}
    <script src="{% static 'assets/js/examples/datatable.js' %}"></script>
    {#    <script src="{% static 'vendors/dataTable/jquery.dataTables.min.js' %}"></script>#}
    <script src="{% static 'vendors/select2/js/select2.min.js' %}"></script>
    <!-- Bootstrap 4 and responsive compatibility -->
    <script src="{% static 'vendors/dataTable/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'vendors/dataTable/dataTables.responsive.min.js' %}"></script>
    {% include 'script_store.html' %}

<script>
function myFunction() {
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("id_search");
  filter = input.value.toUpperCase();
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}
</script>
    <script>
        $('.select2-example').select2({
            placeholder: 'Select'
        });
        $('.select3-example').select2({
            placeholder: 'Select'
        });
        $('.select4-example').select2({
            placeholder: 'Select'
        });
        $('.select5-example').select2({
            placeholder: 'Select'
        });
        $('.select6-example').select2({
            placeholder: 'Select'
        });
        $('.select7-example').select2({
            placeholder: 'Select'
        });

        function getFilter() {
            document.getElementById('FilterCard').style.display = "block";
        }

        function FilterCardClose() {
            document.getElementById('FilterCard').style.display = "none";
        }

        function FilterCardCloseform() {
            document.getElementById('FilterCard').style.display = "none";
        }


        $(document).ready(function () {


            $('#id_search').keyup(function () {

                var search = $(this).val();

                // Hide all table tbody rows
                $('#myTable tbody tr').hide();

                // Count total search result
                var len = $('#myTable tbody tr:not(.notfound) td:contains("' + search + '")').length;

                if (len > 0) {
                    // Searching text in columns and show match row
                    $('#myTable tbody tr:not(.notfound) td:contains("' + search + '")').each(function () {
                        $(this).closest('tr').show();
                    });
                } else {
                    $('.notfound').show();
                }

            });
        });


        $('#check_all').on('click', function () {

            if ($(this).is(":checked", true)) {
                $('.checkbox').prop('checked', true);
            } else {
                $('.checkbox').prop('checked', false);
            }
        });
        $('.checkbox').on('click', function () {
            if ($('.checkbox:checked').length == $('.checkbox').length) {
                $('#check_all').prop('checked', true)
            } else {
                $('#check_all').prop('checked', false)
            }
        })
        $('#check_alldel').on('click', function () {

            if ($(this).is(":checked", true)) {
                $('.checkbox1').prop('checked', true);
            } else {
                $('.checkbox1').prop('checked', false);
            }
        });
        $('.checkbox1').on('click', function () {
            if ($('.checkbox1:checked').length == $('.checkbox1').length) {
                $('#check_alldel').prop('checked', true)
            } else {
                $('#check_alldel').prop('checked', false)
            }
        })
    </script>
{% endblock %}

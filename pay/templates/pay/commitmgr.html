{% extends 'base.html' %}
{% load humanize %}
{% load static %}
{% block context %}
    {% include 'message.html' %}
    <div class="main-container>">
        <div class="card">
            <h2>تائید حقوق و دستمزد پشتیبان</h2>
            <h4>{% if prev_month_name %}مقایسه با ماه {{ prev_month_name }}{% endif %}</h4>
            <br>
            <form action="" method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-lg-2 col-md-2 col-sm-12"></div>
                    <div class="col-lg-2 col-md-2 col-sm-12">
                        <label>انتخاب ماه</label>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12">
                        <select name="period" id="id_period" class="form-control">
                            <option value="0">دوره مورد نظر را انتخاب کنید</option>
                            {% for mon in mounts %}
                                <option {% if mon.id == period %}selected{% endif %}
                                        value="{{ mon.id }}">{{ mon.mount }} - {{ mon.year }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-2 col-sm-12">
                        <button type="submit" class="btn btn-info">مشاهده</button>
                    </div>
                </div>
            </form>

            <div class="row mt-3">
                <div class="col-12">
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle"></i>
                        این گزارش مقادیر ماه جاری را با ماه قبل مقایسه می‌کند. اعداد داخل پرانتز تغییرات نسبت به ماه قبل را نشان می‌دهند.
                    </div>
                </div>
            </div>

            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="table-responsive">
                    <table id="myTable" class="table table-striped table-bordered">
                        <caption style="display: none">تایید حقوق و مقایسه با ماه قبل</caption>
                        <thead>
                            <th scope="col" rowspan="2">نام پشتیبان</th>
                            <th scope="col" class="text-center" colspan="3">فوق العاده جذب</th>
                            <th scope="col" class="text-center" colspan="3">ضریب اتلاف وقت</th>
                            <th scope="col" class="text-center" colspan="3">اضافه کاری</th>
                            <th scope="col" class="text-center" colspan="3">جمع کل</th>
                            <th scope="col" rowspan="2">وضعیت</th>
                            <th scope="col" rowspan="2">وضعیت پرداخت</th>
                            <th scope="col" rowspan="2">مشاهده فیش حقوقی</th>
                        </thead>
                        <thead>
                            <tr>
                                <th></th>
                                <!-- فوق العاده جذب -->
                                <th scope="col" class="text-center">مقدار</th>
                                <th scope="col" class="text-center">مبلغ</th>
                                <th scope="col" class="text-center">تغییرات</th>

                                <!-- ضریب اتلاف وقت -->
                                <th scope="col" class="text-center">مقدار</th>
                                <th scope="col" class="text-center">مبلغ</th>
                                <th scope="col" class="text-center">تغییرات</th>

                                <!-- اضافه کاری -->
                                <th scope="col" class="text-center">مقدار</th>
                                <th scope="col" class="text-center">مبلغ</th>
                                <th scope="col" class="text-center">تغییرات</th>

                                <!-- جمع کل -->
                                <th scope="col" class="text-center">جاری</th>
                                <th scope="col" class="text-center">قبلی</th>
                                <th scope="col" class="text-center">تغییرات</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for list in thislist %}
                            <tr>
                                <td>{{ list.name }}</td>

                                <!-- فوق العاده جذب -->
                                <td class="text-center">
                                    {{ list.current_zarib }}
                                    {% if list.zarib_change != 0 %}
                                        <br>
                                        <small class="{% if list.zarib_change > 0 %}text-success{% else %}text-danger{% endif %}">
                                            ({% if list.zarib_change > 0 %}+{% endif %}{{ list.zarib_change }})
                                        </small>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {{ list.current_zprice|intcomma:False }}
                                    {% if list.zprice_change != 0 %}
                                        <br>
                                        <small class="{% if list.zprice_change > 0 %}text-success{% else %}text-danger{% endif %}">
                                            ({% if list.zprice_change > 0 %}+{% endif %}{{ list.zprice_change|intcomma:False }})
                                        </small>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {% if list.zprice_change > 0 %}
                                        <span class="badge bg-success">↑ افزایش</span>
                                    {% elif list.zprice_change < 0 %}
                                        <span class="badge bg-danger">↓ کاهش</span>
                                    {% else %}
                                        <span class="badge bg-secondary">بدون تغییر</span>
                                    {% endif %}
                                </td>

                                <!-- ضریب اتلاف وقت -->
                                <td class="text-center">
                                    {{ list.current_etlaf }}
                                    {% if list.etlaf_change != 0 %}
                                        <br>
                                        <small class="{% if list.etlaf_change > 0 %}text-success{% else %}text-danger{% endif %}">
                                            ({% if list.etlaf_change > 0 %}+{% endif %}{{ list.etlaf_change }})
                                        </small>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {{ list.current_etlafprice|intcomma:False }}
                                    {% if list.etlafprice_change != 0 %}
                                        <br>
                                        <small class="{% if list.etlafprice_change > 0 %}text-success{% else %}text-danger{% endif %}">
                                            ({% if list.etlafprice_change > 0 %}+{% endif %}{{ list.etlafprice_change|intcomma:False }})
                                        </small>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {% if list.etlafprice_change > 0 %}
                                        <span class="badge bg-success">↑ افزایش</span>
                                    {% elif list.etlafprice_change < 0 %}
                                        <span class="badge bg-danger">↓ کاهش</span>
                                    {% else %}
                                        <span class="badge bg-secondary">بدون تغییر</span>
                                    {% endif %}
                                </td>

                                <!-- اضافه کاری -->
                                <td class="text-center">
                                    {{ list.current_ezafe }}
                                    {% if list.ezafe_change != 0 %}
                                        <br>
                                        <small class="{% if list.ezafe_change > 0 %}text-success{% else %}text-danger{% endif %}">
                                            ({% if list.ezafe_change > 0 %}+{% endif %}{{ list.ezafe_change }})
                                        </small>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {{ list.current_eprice|intcomma:False }}
                                    {% if list.eprice_change != 0 %}
                                        <br>
                                        <small class="{% if list.eprice_change > 0 %}text-success{% else %}text-danger{% endif %}">
                                            ({% if list.eprice_change > 0 %}+{% endif %}{{ list.eprice_change|intcomma:False }})
                                        </small>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {% if list.eprice_change > 0 %}
                                        <span class="badge bg-success">↑ افزایش</span>
                                    {% elif list.eprice_change < 0 %}
                                        <span class="badge bg-danger">↓ کاهش</span>
                                    {% else %}
                                        <span class="badge bg-secondary">بدون تغییر</span>
                                    {% endif %}
                                </td>

                                <!-- جمع کل -->
                                <td class="text-center">
                                    <strong>{{ list.current_sum|intcomma:False }}</strong>
                                </td>
                                <td class="text-center">
                                    {{ list.prev_sum|intcomma:False }}
                                </td>
                                <td class="text-center">
                                    {% if list.sum_change > 0 %}
                                        <span class="badge bg-success">
                                            ↑ +{{ list.sum_change|intcomma:False }}
                                        </span>
                                    {% elif list.sum_change < 0 %}
                                        <span class="badge bg-danger">
                                            ↓ {{ list.sum_change|intcomma:False }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">بدون تغییر</span>
                                    {% endif %}
                                </td>

                                <!-- وضعیت و پرداخت -->
                                {% if list.accept == True %}
                                    <td style="color: #00a345">
                                        تائید شده
                                    </td>
                                {% else %}
                                    <td style="color: #ff8f83">
                                        تائید نشده
                                    </td>
                                {% endif %}

                                <!-- وضعیت پرداخت -->
                                <td>
                                    {% if list.acceptpay == True %}
                                        <span style="color: #00a345">
                                            پرداخت شده
                                        </span>
                                    {% else %}
                                        <span style="color: #ff8f83">
                                            پرداخت نشده
                                        </span>
                                    {% endif %}
                                </td>

                                <td>
                                    <a href="{% url 'pay:fish' list.period list.id %}" type="button" class="btn btn-warning btn-sm">
                                        مشاهده
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            {% if request.user.owner.refrence_id == 1 %}
            <div class="row mt-3">
                <div class="col-5"></div>
                <div class="col-4">
                    <a style="color: #fbfdff" href="{% url 'pay:accesptmgr' period %}" class="btn btn-success">
                        تائید لیست فوق
                    </a>
                </div>
                <div class="col-3"></div>
                <br>
                <br>
            </div>
            {% endif %}
        </div>
    </div>

    <style>
        .badge {
            font-size: 0.8em;
            padding: 4px 8px;
        }
        small {
            font-size: 0.8em;
        }
        .text-success {
            color: #28a745 !important;
        }
        .text-danger {
            color: #dc3545 !important;
        }
        .table th {
            vertical-align: middle;
            text-align: center;
        }
        .table td {
            vertical-align: middle;
        }
    </style>
{% endblock %}
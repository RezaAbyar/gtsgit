{% extends "base.html" %}
{% load static %}
{% block context %}
      <script src="{% static 'assets/js/jquery-3.5.1.min.js' %}"></script>
<h1>تغییر وضعیت سریال‌ها بر اساس تاریخ</h1>

<form method="post">
    {% csrf_token %}
    <div class="form-group">
        <label>وضعیت فعلی:</label>
        <select class="form-control" name="current_status" required>
            <option value="">-- انتخاب کنید --</option>
            {% for status in statuses %}
            <option value="{{ status.id }}">{{ status.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>تاریخ قطع (قبل از):</label>
        <input class="form-control" type="text" name="cutoff_date" required>
    </div>

    <div class="form-group">
        <label>وضعیت جدید:</label>
        <select class="form-control" name="new_status" required>
            <option value="">-- انتخاب کنید --</option>
            {% for status in statuses %}
            <option value="{{ status.id }}">{{ status.name }}</option>
            {% endfor %}
        </select>
    </div>

    <button type="submit" class="button">بررسی و نمایش پیش‌نمایش</button>

    {% if show_preview %}
    <div class="preview">
        <h2>پیش‌نمایش</h2>
        <p>تعداد سریال‌های یافت شده: <strong>{{ count }}</strong></p>
        <p>تغییر وضعیت از <strong>{{ current_status.name }}</strong> به <strong>{{ new_status.name }}</strong></p>
        <p>برای سریال‌هایی که تاریخ بروزرسانی آنها قبل از <strong>{{ cutoff_date }}</strong> باشد</p>

    <table>
        <tr>
        <th>
            serial
        </th>
        </tr>
        <tbody>
        {% for item in target_serials %}
        <tr>
        <td>
            {{ item.serial }}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
        {% if count > 0 %}
        <button type="submit" name="confirm" value="1" class="button"
                onclick="return confirm('آیا از تغییر وضعیت {{ count }} سریال مطمئن هستید؟')">
            تایید و اجرای تغییرات
        </button>
        {% endif %}
    </div>
    {% endif %}
</form>
{% endblock %}
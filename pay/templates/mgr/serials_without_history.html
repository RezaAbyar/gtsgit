{% extends "base.html" %}

{% block context %}
<h1>سریال‌های بدون سابقه</h1>

<form method="post" id="serialForm">
    {% csrf_token %}
    <div class="actions">
        <button type="submit" name="delete_selected" class="button" onclick="return confirm('آیا از حذف سریال‌های انتخاب شده مطمئن هستید؟')">
            حذف انتخاب شده‌ها
        </button>
    </div>

    <table>
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th>سریال</th>
                <th>وضعیت</th>
                <th>تاریخ ایجاد</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            {% for serial in serials %}
            <tr>
                <td><input type="checkbox" name="selected_serials" value="{{ serial.id }}"></td>
                <td>{{ serial.serial }}</td>
                <td>{{ serial.status.name }}</td>
                <td>{{ serial.create|date:"Y/m/d" }}</td>
                <td>
                    <button type="button" class="button delete-single" data-serial-id="{{ serial.id }}">
                        حذف
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">هیچ سریال بدون سابقه‌ای پیدا نشد</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</form>

<script>
document.getElementById('selectAll').addEventListener('click', function() {
    const checkboxes = document.querySelectorAll('input[name="selected_serials"]');
    checkboxes.forEach(checkbox => checkbox.checked = this.checked);
});

document.querySelectorAll('.delete-single').forEach(button => {
    button.addEventListener('click', function() {
        const serialId = this.dataset.serialId;
        if (confirm('آیا از حذف این سریال مطمئن هستید؟')) {
            fetch(`/pay/serials-without-history/delete/${serialId}/`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.success) {
                    location.reload();
                }
            });
        }
    });
});
</script>
{% endblock %}
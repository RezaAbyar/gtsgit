{% extends 'base.html' %}

{% load static %}
{% block context %}
      <script src="{% static 'assets/js/jquery-3.5.1.min.js' %}"></script>
<div class="card">
    <div class="card-header">
        <h3 class="card-title">لیست گواهی‌های جایگاه‌ها</h3>
                            <div class="alert alert-warning" role="alert">
  <strong>⚠ یادآوری مهم:</strong>
   <strong> حتما قبل از ثبت گواهی ها ویدئو آموزشی مربوطه را مشاهده بفرمایید </strong>
  <a  href="https://aparat.com/v/zfasts6"
                                   class="btn btn-apple">مشاهده  ویدئوآموزشی </a>

</div>
        <div class="card">
            <div class="card-body">
                <h3 class="c-center c-font-uppercase c-font-bold">گزارش فروش دهه و ماه</h3>
                <form action="" method="post">
                    {% csrf_token %}
                    <hr>
                    <div class="row">


                        <div class="col-lg-2 col-md-6 col-sm-12">
                            <label class="form-label">منطقه</label>
                            <select name="zone" id="id_zone" class="form-control" onchange="areainzone(this.value);">
                                <option value="0">همه مناطق</option>
                                {% for zone in zones %}
                                    <option value="{{ zone.id }}">{{ zone.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-lg-2 col-md-6 col-sm-12">
                            <label class="form-label">ناحیه</label>
                            <select name="area" id="id_area" class="form-control" onchange="cityinarea(this.value);">
                                <option value="0">همه نواحی</option>
                            </select>
                        </div>

                        <div class="col-lg-2 col-md-6 col-sm-12">
                            <label class="form-label">جایگاه</label>
                            <select name="gs" id="id_gs" class="form-control select2">
<option value="0">همه</option>
                                {% for gs in gs_list %}
                                    <option value="{{ gs.id }}">{{ gs.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-lg-2 col-md-6 col-sm-12">
                            <label class="form-label">نوع گواهی</label>

                            <select name="product" id="product" class="form-control">
                               <option value="0">همه</option>
                                {% for certificatetype in certificatetypes %}
                                    <option {% if product_id == certificatetype.id %} selected {% endif %} value="{{ certificatetype.id }}">{{ certificatetype.name }}</option>
                                {% endfor %}
                            </select>
                        </div>


{#                           <div class="col-lg-2 col-md-6 col-sm-12">#}
{#                            <label class="form-label">وضعیت</label>#}
{#                            <select name="product" id="product" class="form-control">#}
{#                                {% for product in products %}#}
{#                                    <option {% if product_id == product.id %} selected {% endif %} value="{{ product.id }}">{{ product.name }}</option>#}
{#                                {% endfor %}#}
{#                            </select>#}
{#                        </div>#}
   </div>

                    <div class="row mt-3">
                        <div class="col-lg-12 text-center">
                            <button type="submit" class="btn btn-warning c-btn-uppercase">فیلتر</button>
{#                            <a onclick="exportToExcelWithBorders()" id="exportBtn1" style="color: #fffbff" class="btn nav-link bg-info" title="ارسال به اکسل ">#}
{#                                <i data-feather="send" aria-hidden="true"></i>ارسال به اکسل#}
{#                            </a>#}
                        </div>
                    </div>

                </form>
        <div class="card-tools">
            <a style="color: #f5f5f5" href="{% url 'visit:certificate_create' %}" class="btn btn-primary">
                <i class="fa fa-plus"></i> ثبت گواهی جدید
            </a>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>جایگاه</th>
                    <th>نوع گواهی</th>
                    <th>تاریخ صدور</th>
                    <th>تاریخ انقضا</th>
                    <th>وضعیت</th>
                    <th>عملیات</th>
                </tr>
            </thead>
            <tbody>
                {% for cert in certificates %}
                <tr class="{% if cert.is_expired %}table-danger{% elif cert.days_until_expiry < 30 %}table-warning{% endif %}">
                    <td>{{ cert.gs.name }}</td>
                    <td>{{ cert.certificate_type.name }}</td>
                    <td>{{ cert.issue_date }}</td>
                    <td>{{ cert.expiry_date }}</td>
                    <td>
                        {% if cert.is_expired %}
                        <span class="badge badge-danger">منقضی شده</span>
                        {% elif cert.days_until_expiry < 30 %}
                        <span class="badge badge-warning">نزدیک به انقضا ({{ cert.days_until_expiry }} روز)</span>
                        {% else %}
                        <span class="badge badge-success">معتبر</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'visit:certificate_detail' cert.pk %}" class="btn btn-sm btn-info">
                            <i class="fa fa-eye"></i> مشاهده
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script>
        // مقداردهی اولیه Select2 برای جایگاه
        $(document).ready(function() {
            $('#id_gs').select2({
                placeholder: "جستجو و انتخاب جایگاه",
                allowClear: true,
                language: "fa",
                width: '100%'
            });
        });
    </script>
    {% include 'script_sell.html' %}
{% endblock %}
{% extends 'basemessage.html' %}
{% load static %}
{% block context %}
{#    <script src="{% static 'assets/js/jquery-3.5.1.min.js' %}"></script>#}
{#  <link href="{% static 'vendors/quill/quill.snow.css' %}">#}
<link rel="stylesheet" href="{% static 'vendors/select2/css/select2.min.css' %}" type="text/css">
    <!-- Tagsinput -->
{#     <link href="{% static 'vendors/tagsinput/bootstrap-tagsinput.css' %}">#}
    {% include 'message.html' %}
    <div class="row app-block">
{% include 'menumsg.html' %}
        <div class="col-md-9 app-content">
            <div class="app-content-overlay"></div>
        {% if id != 'send' %}
{% include 'actionmsg.html' %}
        {% endif %}
            <div class="card card-body app-content-body">
                <div class="app-lists">

{% if id in 'inbox,star,remove' %}
    {% include 'recive.html' %}
{% elif id == 'send' %}
    {% include 'sendmsg.html' %}
{% endif %}

{% csrf_token %}

                <!-- end::app-lists -->

                <!-- begin:app-detail -->
                <div class="card app-detail">
                    <div class="card-header">
                        <div class="app-detail-action-left">
                            <a class="app-detail-close-button" href="#">
                                <i data-feather="arrow-right" class="mr-3 mt-1" aria-hidden="true"></i>
                            </a>
                            <h5 id="titelId" class="mb-0">
</h5>


                        </div>
                          <h3 id="refId" class="badge bg-success badge-pill ml-4"></h3>
                        <div class="app-detail-action-right">
                            <div>

{#                                <a href="{% url 'msg:delmsg' msg.id %}" class="btn btn-outline-light ml-2" data-toggle="tooltip" title="پاک کردن">#}
{#                                    <i data-feather="trash" aria-hidden="true"></i>#}
{#                                </a>#}
                            </div>
                        </div>
                    </div>
                    <div class="app-detail-article">
                        <div class="card-body">
                            <div class="d-flex align-items-center p-l-r-0 m-b-20">
                                <div class="d-flex align-items-center">
                                    <figure class="avatar avatar-sm m-r-15">
                                       <span id="imgId" class="avatar-title bg-warning-bright text-info rounded-circle"></span>

                                    </figure>
                                    <div>
                                        <h6 class="m-b-0">
                                            <span id="nameId" class="text-primary">{{ msg.msg.owner }}</span>
                                            <span class="d-sm-inline d-none text-muted"> </span>
                                        </h6>
                                        <span id="sematId" class="small text-muted"></span>
                                    </div>
                                </div>
                                <div class="ml-auto">

                                    <span id="timeId" class="text-muted">{{ msg.msg.ptime }}</span>
                                </div>
                            </div>
                            <p id="infoId"></p>
           <a class="app-detail-close-button" href="#">
                         <span class="btn btn-outline-warning"> بستن پیام</span>
                            </a>


                             <a class="app-detail-close-button" onclick="goorginal()">
                         <span class="btn btn-outline-success">همه گفتگو ها</span>
                            </a>
        <form id="chatid" action="{% url 'msg:chat' %}" method="post">
                     {% csrf_token %}
                        <input type="hidden" id="orginalid" name="orginalid">
                        <input type="hidden" id="msgnewid">
                 </form>
                        </div>
                         <hr class="m-0">
                            <div id="attachfile"  class="card-body">
                                <h6 class="mb-3 font-size-11 text-uppercase">فایل های الحاق شده</h6>
                                <ul class="list-unstyled mb-0">
                                    <li class="small">
                                        <a id="attach" href="#" onclick="Download()">
                                            <i data-feather="paperclip" class="mr-1 width-15 height-15" aria-hidden="true"></i>
                                            دریافت فایل
                                        </a>
                                    </li>

                                </ul>
                            </div>

                       <div style="display: none" id="sendreply">
                 <form action=" {% url 'msg:replyMsg' %}" method="post">
                     {% csrf_token %}

                        <input type="hidden" id="msgidnew" name="msgidnew">
                            <hr class="m-0">
                            <div class="card-body">
                                <h6 class="mb-3 font-size-11 text-uppercase">پاسخ</h6>
                                <div class="reply-email-quill-editor col-11">
                                 <textarea name="reply" class="form-control"></textarea></div>
                                <div class="d-flex justify-content-between">
                                    <div class="reply-email-quill-toolbar">

                                    </div>

                                </div>

                            </div>
                     <style>
                         .formcenter {
  display: flex;
  flex-direction: row;
  justify-content: center;
  width: 100%;
  gap: 1em;
}
                     </style>
                     <div class="formcenter">
                                        <button class="btn btn-primary">
                                        <i data-feather="send" class="mr-2" aria-hidden="true"></i>
                                        ارسال
                                    </button>
                     </form>

                           </div>
                                  <br>
                           <br>
                           <br>
                           <br>
                           <br>
                           <br>
                       </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



    <!-- end::main-content -->

     <footer>

    </footer>
    <!-- end::footer -->

</div>
<!-- end::main -->


<div class="modal fade" tabindex="-1" role="dialog" id="compose">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">نوشتن پیام</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="بستن">
                    <i class="ti-close" aria-hidden="true"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="d-flex justify-content-between m-b-20">
                    {% if request.user.owner.role.role != 'gs' %}
                    <div>
                        <select class="form-control" onchange="getRole(this.value)" name="filterrole" id="filterrole">
                            <option value="gs">جایگاه داران</option>
                            <option value="tek">پشتیبانان</option>
                             {% if request.user.owner.role.role != 'tek' %}
                            <option value="zone">مناطق</option>
                            <option value="area">نواحی</option>
                            <option value="setad">ستادی</option>
                            <option value="group">ارسال گروهی</option>
                                 {% endif %}
                        </select>
                    </div>
                    {% endif %}
                </div>
                <form action="" method="post">
{% csrf_token %}
                    <div class="form-group">

                    <select  name="owner" id="id_owners" class="select2-example form-select" multiple>
                        <{% for owner in owners %}
                            <option value="{{ owner.id }}">{{ owner }}</option>
                        {% endfor %}>
                    </select>
                    </div>
                <div class="form-group">
    <div class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" name="isreplay" id="isreplay" checked>
        <label class="custom-control-label" for="isreplay">امکان دریافت پاسخ</label>
    </div>
</div>
                    <div class="form-group">
                        <input name="titel" type="text" class="form-control" placeholder="موضوع" required>
                    </div>
                    <div class="form-group">
                        <div class="custom-file">
                            <textarea style="height: 100px" class="form-control" name="info"></textarea>
                        </div>
                    </div>
                    <div>
                        <div class="compose-quill-editor mb-3"></div>
                        <div class="d-flex justify-content-between">
                            <div class="compose-quill-toolbar">
                            <span class="ql-formats mr-0">

                            </span>
                            </div>

                            <button class="btn btn-primary">
                                <i data-feather="send" class="mr-2" aria-hidden="true"></i>
                                ارسال
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
        <div class="modal fade" id="EventList" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">رویداد های این پیام</h5>
                <button type="button" class="btn nav-link bg-info-bright" aria-label="Close" data-dismiss="modal">
                    <i class="ti-close" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                  <div class="table-responsive">
                    <table id="SerialTable" class="table table-striped table-bordered">
                         <caption style="display: none">پیام ها</caption>
                    <thead>
                    <tr>
                        <th scope="col"> نام گیرنده</th>
                        <th scope="col"> وضعیت</th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>

                </table>

                  </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <ul class="nav">
                        <li class="nav-item">

                        </li>
                    </ul>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">بستن
                    </button>

                </div>
            </div>
        </div>
    </div>
{% block script %}

    <script src="{% static 'assets/js/msgv4.js' %}"></script>
    <script src="{% static 'vendors/select2/js/select2.min.js' %}"></script>


<script>
function goorginal(){

    var myidmsg=document.getElementById('msgnewid').value
    if (myidmsg > 11144) {
        document.getElementById('orginalid').value = document.getElementById('orginal' + myidmsg).value

        document.getElementById('chatid').submit()
    }else{
        alarm('warning','این قابلیت برای پیام های جدید فعال میباشد')
    }
}

        $('.select2-example').select2({
            placeholder: 'انتخاب گیرندگان',

        });


        $(function () {
            $(document).on('click', '.app-block .app-content .app-action .action-left input[type="checkbox"]', function () {
                $('.app-lists ul li input[type="checkbox"]').prop('checked', $(this).prop('checked'));
                if ($(this).prop('checked')) {
                    $('.app-lists ul li input[type="checkbox"]').closest('li').addClass('active');
                } else {
                    $('.app-lists ul li input[type="checkbox"]').closest('li').removeClass('active');
                }
            });
$(document).on('click', function () {

});
            $(document).on('click', '.app-lists ul li input[type="checkbox"]', function () {
                if ($(this).prop('checked')) {
                    $(this).closest('li').addClass('active');
                } else {
                    $(this).closest('li').removeClass('active');
                }
            });

            $(document).on('click', '.app-block .app-content .app-content-body .app-lists ul.list-group li.list-group-item', function (e) {

                if (!$(e.target).is('.custom-control, .custom-control *, a, a *')) {

                    $('.app-detail').addClass('show').one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                        $('.app-block .app-content .app-content-body .app-detail .app-detail-article').niceScroll({railalign: 'left'}).resize();

                    });
                }
            });

            $(document).on('click', 'a.app-detail-close-button', function () {

                $('.app-detail').removeClass('show');
                return false;
            });

            $(document).on('click', '.app-sidebar-menu-button', function () {
                $('.app-block .app-sidebar, .app-content-overlay').addClass('show');
                // $('.app-block .app-sidebar .app-sidebar-menu').niceScroll({railalign: 'left'}).resize();
                return false;
            });

            $(document).on('click', '.app-content-overlay', function () {
                $('.app-block .app-sidebar, .app-content-overlay').removeClass('show');
                return false;
            });
        });
    </script>
    {% endblock %}
{% endblock %}
{% extends 'base.html' %}
{% load static %}
{% load basefiltertag %}
{% block context %}
    <script src="{% static 'assets/js/tableToExcel.js' %}"></script>
    <link type="text/css" rel="stylesheet" href="{% static 'assets/css/jalalidatepicker.min.css' %} "/>
    <script type="text/javascript" src="{% static 'assets/js/jalalidatepicker.min.js' %}"></script>
    <style>

    </style>
<div class="card">
<div class="card-body">
<p>انتخاب تاریخ جهت مشاهده  وضعیت تیکت ها در روزهای قبل</p>
     <form action="" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-lg-1 col-md-1 col-sm-1"></div>
        <div class="col-lg-2 col-md-5 col-sm-12">
            <label>انتخاب تاریخ
                <input required data-jdp type="text" name="select" id="select" value="{{ tarikh }}" class="form-control"
                       placeholder="تاریخ" autocomplete="off">
            </label>

            <label for="id_hour">ساعت
            <select name="hour" id="id_hour" class="form-control">
                <option {% if hour == "-" %}selected{% endif %} value="-">-</option>
                <option {% if hour == "00" %}selected{% endif %} value="00">0</option>
                <option {% if hour == "01" %}selected{% endif %} value="01">1</option>
                <option {% if hour == "02" %}selected{% endif %} value="02">2</option>
                <option {% if hour == "03" %}selected{% endif %} value="03">3</option>
                <option {% if hour == "04" %}selected{% endif %} value="04">4</option>
                <option {% if hour == "05" %}selected{% endif %} value="05">5</option>
                <option {% if hour == "06" %}selected{% endif %} value="06">6</option>
                <option {% if hour == "07" %}selected{% endif %} value="07">7</option>
                <option {% if hour == "08" %}selected{% endif %} value="08">8</option>
                <option {% if hour == "09" %}selected{% endif %} value="09">9</option>
                <option {% if hour == "10" %}selected{% endif %} value="10">10</option>
                <option {% if hour == "11" %}selected{% endif %} value="11">11</option>
                <option {% if hour == "12" %}selected{% endif %} value="12">12</option>
                <option {% if hour == "13" %}selected{% endif %} value="13">13</option>
                <option {% if hour == "14" %}selected{% endif %} value="14">14</option>
                <option {% if hour == "15" %}selected{% endif %} value="15">15</option>
                <option {% if hour == "16" %}selected{% endif %} value="16">16</option>
                <option {% if hour == "17" %}selected{% endif %} value="17">17</option>
                <option {% if hour == "18" %}selected{% endif %} value="19">18</option>
                <option {% if hour == "19" %}selected{% endif %} value="19">19</option>
                <option {% if hour == "20" %}selected{% endif %} value="20">20</option>
                <option {% if hour == "21" %}selected{% endif %} value="21">21</option>
                <option {% if hour == "22" %}selected{% endif %} value="22">22</option>
                <option {% if hour == "23" %}selected{% endif %} value="23">23</option>
            </select></label>
            </div>
            <div class="m-3 col-lg-4 col-md-4 col-sm-12">
            <button style="color: #FFFFFF" type="submit" id="exportBtn12" class="btn btn-primary">ایجاد گزارش</button>

            <a href="{% url 'base:master_pinpad_tickets_Toexcel' 1 %}" id="exportBtn12" class="btn btn-warning">
                <i class="fa fa-file-excel-o"></i>
                خروجی
                اکسل </a>
            </div>
            <div class="col-lg-5 col-md-4 col-sm-12"></div>
        </div>

    </form>
</div>
</div>
    {% include 'message.html' %}

    <div class="card">
<form action="" method="get">  <!-- تغییر به method="get" -->
    <!-- سایر فیلدهای موجود -->

    <div class="col-lg-4 col-md-4 col-sm-12">
        <label for="product">فرآورده</label>
        <select name="product" id="id_product" class="select2-example" multiple>
            {% for product in products %}
                <option value="{{ product.id }}"
                    {% if product.id|stringformat:"s" in selected_products %}selected{% endif %}>
                    {{ product.name }}
                </option>
            {% endfor %}
        </select>
     <button type="submit" class="btn btn-primary">اعمال فیلتر</button>
    </div>


</form>


    <br>

    <div class="card-body">

    <div class="table-responsive">
    <table id="myTable" class="table table-striped table-bordered">
    <ul class="nav">
{#        <li class="nav-item">#}
{#            <button id="btnfilters" onclick="getFilter()" class="btn btn-success" title="فیلتر "#}
{#               data-toggle="tooltip">#}
{#                <i data-feather="filter" aria-hidden="true"></i>#}
{#            </button>#}
{##}
{#        </li>#}

<li class="nav-item">
     <button onclick="exportToExcelWithBorders()"  id="exportBtn1" class="btn btn-light" title="ارسال به اکسل این جدول" data-toggle="tooltip">
         <i class="fa fa-file-excel-o" style="font-size:18px;color:darkgreen"></i>
                 </button>
          </li>
    </ul>
     <caption style="display: none">گزارش وضعیت خرابی</caption>
        <thead>
        <tr>

             <th scope="col"  class="text-center">ردیف</th>
             <th scope="col"  class="text-center">منطقه</th>
             <th scope="col"  class="text-center">تعداد جایگاه</th>
             <th scope="col"  class="text-center">تعداد نازل</th>
             <th scope="col"  class="text-center">تعداد تیکت ها</th>
             <th scope="col"  class="text-center">تعداد تیکت کارتخوان</th>
             <th scope="col"  class="text-center">تعداد تیکت صفحه کلید</th>
             <th scope="col"  class="text-center">
                {% if id == 1 %}<i data-feather="arrow-down" aria-hidden="true"></i>{% endif %}
                <a href="{% url 'base:MasterPinPad_Tickets' 1 %}">درصد خرابی کارتخوان</a>
            </th>


             <th scope="col"  class="text-center">
                {% if id == 2 %}<i data-feather="arrow-down" aria-hidden="true"></i>{% endif %}
                <a href="{% url 'base:MasterPinPad_Tickets' 2 %}">درصد خرابی صفحه کلید</a>
            </th>
             <th scope="col"  class="text-center">
                {% if id == 3 %}<i data-feather="arrow-down" aria-hidden="true"></i>{% endif %}
                <a href="{% url 'base:MasterPinPad_Tickets' 3 %}"> مجموع درصد خرابی</a>
            </th>


        </tr>
        </thead>


        {% for item in list %}
            {##}
            <tr {% if item.st == 1 %} style="background-color: #c3e7a5; color: black" {% elif item.st == 2 %}
                                      style="background-color: #4ba2e4; color: black" {% endif %}>
                {% if item.name == 'مجموع' %}
                    <td class="text-center">-</td>
                    <td class="text-center">
                        <l6>{{ item.name }}</l6>
                    </td>

                {% else %}
                    <td class="text-center">{{ forloop.counter }}</td>
                    <td class="text-center"><a href="{% url 'base:MasterPinpad_Ticketnahye' item.id|to_md5 %}">
                        <l6>{{ item.name }}</l6>
                    </a></td>

                {% endif %}

                <td class="text-center">{{ item.count_gs }}</td>
                <td class="text-center">{{ item.count_pump }}</td>
                <td class="text-center">{{ item.count_ticket }}</td>
                <td class="text-center">{{ item.count_master }}</td>
                <td class="text-center">{{ item.count_pinpad }}</td>
                <td class="text-center">{{ item.master }}</td>
                <td class="text-center">{{ item.pinpad }}</td>
                <td class="text-center">{{ item.summ }}</td>

            </tr>

        {% endfor %}
        </tfoot>
    </table>

{% endblock %}
{% block script %}
    <script src="{% static 'assets/js/examples/datatable.js' %}"></script>

    <script src="{% static 'vendors/dataTable/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'vendors/dataTable/dataTables.responsive.min.js' %}"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            jalaliDatepicker.startWatch();
            $("#exportBtn11").click(function () {
                TableToExcel.convert(document.getElementById("myTable"), {
                    name: "list.xlsx",
                    sheet: {
                        name: "Sheet1"
                    }
                });
            });
        });
                $('.select2-example').select2({
            placeholder: 'Select'
        });
         function getFilter() {
            document.getElementById('FilterCard').style.display = "block";
            document.getElementById('btnfilters').style.display = "none";
        }

        function FilterCardClose() {
            document.getElementById('FilterCard').style.display = "none";
            document.getElementById('isfilter').value = '1'
            document.getElementById('btnfilters').style.display = "block";
        }

        function FilterCardCloseform() {
            document.getElementById('FilterCard').style.display = "none";
            document.getElementById('btnfilters').style.display = "block";
        }
        function gofilter(){
             document.getElementById('idval').value = "0"
            document.getElementById('formsub').submit()
        }
    </script>

{% endblock %}
{% extends 'base.html' %}
{% load static %}

{% block context %}
    <script src="{% static 'assets/js/tableToExcel.js' %}"></script>
    <script src="{% static 'assets/js/jquery-3.5.1.min.js' %}"></script>
    {% include 'message.html' %}


    <br>
    <div id="big_nemodar_owner" class="card">


        <div class="card-body">
            <h6 class="card-title d-flex justify-content-between">
                <span>نمودار نسبت خرابی جایگاه ها</span>
                <span class="dropdown primary-font">
                                            <a class="pl-2 pr-2" data-toggle="modal" data-target="#zomsell_nerkh_small"
                                               aria-haspopup="true"
                                               aria-expanded="false">
                                                <i class="fa fa-search-plus" aria-hidden="true"></i>
                                            </a>

                                        </span></h6>
            </h6>
            <form action="" method="post">
            {% csrf_token %}
            <div class="input-group">
{#                <select name="job_type" class="form-control">#}
{#                    <option value="" selected disabled>انتخاب کنید</option>#}
{#                    <option value="group">تجمعی</option>#}
{#                    <option value="detail">جایگاه ها</option>#}
{#                </select>#}

                <select class="form-control" name="store_type">
                    <option {% if store_type == 'all' %} selected {% endif %} value="all"> مرتب سازی بر اساس مجموع خرابی ها</option>
                    <option value="master" {% if store_type == 'master' %}selected {% endif %}>مرتب سازی بر اساس کارتخوان </option>
                    <option value="pinpad" {% if store_type == 'pinpad' %}selected {% endif %}>مرتب سازی بر اساس صفحه کلید</option>
                </select>
                {% if zones %}
                    <select class="form-control" name="zone_type">
                        <option value="" selected disabled>انتخاب کنید</option>
                        <option value="zone">مناطق</option>
                        <option value="area"> نواحی</option>
                    </select>
                {% endif %}
                {% if zones %}
                    <select class="form-control" name="zone_list">
                        <option value="0" selected>همه مناطق</option>
                        {% for zone in zones %}
                            <option value="{{ zone.id }}">{{ zone.name }}</option>
                        {% endfor %}
                    </select>
                {% endif %}{% if areas %}
                <select class="form-control" name="area_list">
                    <option value="0" {% if area_list == 0 %} selected {% endif %}> همه نواحی</option>
                    <option value="99990" {% if area_list == 99990 %} selected {% endif %} > تجمعی</option>
                    {% for area in areas %}
                        <option {% if area_list == area.id %} selected {% endif %} value="{{ area.id }}">{{ area.name }}</option>
                    {% endfor %}
                </select>
            {% endif %}

                <button class="btn btn-outline-primary"  type="submit">مشاهده</button>

            </div>
            </form>
            <hr>
            <input type="hidden" id="status_id" value="{{ a }}">
            <div id="chart">
            </div>
        </div>
    </div>
    <script>

{##}
{#        function send_request() {#}
{#            if (document.getElementById('job_type')) {#}
{#                job_type = document.getElementById('job_type').value#}
{#            } else {#}
{#                job_type = 'none'#}
{#            }#}
{##}
{#            if (document.getElementById('store_type')) {#}
{#                store_type = document.getElementById('store_type').value#}
{#            } else {#}
{#                store_type = 'none'#}
{#            }#}
{##}
{#            if (document.getElementById('zone_type')) {#}
{#                zone_type = document.getElementById('zone_type').value#}
{#            } else {#}
{#                zone_type = 'none'#}
{#            }#}
{##}
{#            if (document.getElementById('zone_list')) {#}
{#                zone_list = document.getElementById('zone_list').value#}
{#            } else {#}
{#                zone_list = 'none'#}
{#            }#}
{##}
{#            if (document.getElementById('area_list')) {#}
{#                area_list = document.getElementById('area_list').value#}
{#            } else {#}
{#                area_list = 'none'#}
{#            }#}
{##}
{#            $.ajax({#}
{#                type: 'GET',#}
{#                url: '/ajaxnesbat/',#}
{#                data: {#}
{#                    'job_type': job_type,#}
{#                    'store_type': store_type,#}
{#                    'zone_type': zone_type,#}
{#                    'zone_list': zone_list,#}
{#                    'area_list': area_list,#}
{#                },#}
{#                dataType: "json",#}
{#            }).done(function (data) {#}
{#                console.log(data);#}
{#                console.log('after send');#}
{#            })#}
{##}
{##}
{#        }#}

        $(document).ready(function () {

            var options = {
                series: [{
                    name: 'کارتخوان ',
                    data:[{% for item in masterlist %} {{ item.master }} ,{% endfor %}]
                }, {
                    name: 'صفحه کلید ',
                    data:  [{% for item in masterlist %} {{ item.pinpad }} ,{% endfor %}]
                }

                ],
                chart: {
                    type: 'bar',
                    height: 4350,
                    stacked: true,
                },
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        horizontal: true,
                        dataLabels: {
                            total: {
                                enabled: false,
                                offsetX: 0,

                                style: {
                                    fontSize: '13px',
                                    fontWeight: 900
                                }
                            }
                        }
                    }
                },

                stroke: {
                    width: 1,
                    colors: ['#fff']
                },
                title: {
                    text: ''
                },
                xaxis: {
                    categories: [{% for item in masterlist %} '{{ item.name }}' ,{% endfor %}],
                },
                yaxis: {
                    title: {
                        text: undefined
                    },
                },
                fill: {
                    opacity: 1
                },
                legend: {
                    position: 'top',
                    horizontalAlign: 'left',
                    offsetX: 40
                }
            };

            var chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();


        });
    </script>

    {#{% include 'dashboard/setad/dashboard_script.html' %}#}
{% endblock %}
{% block script %}
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
{% endblock %}
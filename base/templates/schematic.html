<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>شماتیک جایگاه سوخت</title>
    <style>
        body {
            font-family: 'B Nazanin', Tahoma, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            width: 100%;
            overflow: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h2, h3 {
            text-align: center;
            color: #333;
        }
        .station-map {
            margin-top: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            padding: 10px;
        }
        .platform {
            margin-bottom: 40px;
            background: #e9e9e9;
            padding: 15px;
            border-radius: 5px;
            position: relative;
        }
        .platform-title {
            position: absolute;
            top: -10px;
            right: 20px;
            background: #4a6ea9;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        .pumps-row {
            display: flex;
            flex-wrap: nowrap;
            gap: 20px;
            padding-top: 40px;
        }
        .pump {
            background: #d9d9d9;
            border-radius: 5px;
            padding: 10px;
            min-width: 120px;
            position: relative;
        }
        .pump-title {
            position: absolute;
            top: -15px;
            right: 10px;
            background: #5a8f5a;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .nozzles {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .nozzle {
            width: 20px;
            height: 60px;
            border-radius: 3px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .nozzle:hover {
            transform: scale(1.05);
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .nozzle::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .regular { background: #e74c3c; }
        .super { background: #2ecc71; }
        .lpg { background: #f1c40f; }
        .payment-working::after { background: #2ecc71; }
        .payment-faulty::after { background: #e74c3c; }
        .payment-none::after { background: #bdc3c7; }

        /* پنجره اطلاعات */
        .info-window {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            font-family: 'B Nazanin', Tahoma;
            max-width: 300px;
        }
        .info-window h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .info-window p {
            margin: 5px 0;
        }
        .close-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            cursor: pointer;
            background: #e74c3c;
            color: white;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            border-radius: 50%;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>شماتیک جایگاه سوخت</h2>
        <h3>نمایش گرافیکی تلمبه‌ها و نازل‌ها</h3>

        <!-- پنجره اطلاعات -->
        <div id="nozzle-info" class="info-window">
            <span class="close-btn" onclick="document.getElementById('nozzle-info').style.display='none'">×</span>
            <h3>اطلاعات نازل</h3>
            <p><strong>سکو:</strong> <span id="info-platform"></span></p>
            <p><strong>تلمبه:</strong> <span id="info-pump"></span></p>
            <p><strong>نوع سوخت:</strong> <span id="info-product"></span></p>
            <p><strong>وضعیت دستگاه:</strong> <span id="info-status"></span></p>
            <p><strong>شماره نازل:</strong> <span id="info-nozzle-number"></span></p>
        </div>

        <div class="station-map">
            {% for sakoo, platform in platforms.items %}
            <div class="platform" style="min-width: {{ platform.position.width }}px;">
                <div class="platform-title">سکو {{ sakoo }}</div>
                <div class="pumps-row">
                    {% for tolombe, pump in platform.pumps.items %}
                    <div class="pump" style="margin-left: {{ pump.position.x }}px;">
                        <div class="pump-title">تلمبه {{ tolombe }}</div>
                        <div class="nozzles">
                            {% for nozzle in pump.nozzles %}
                            <div class="nozzle
                                 {% if nozzle.product == 'بنزین معمولی' %}regular
                                 {% elif nozzle.product == 'بنزین سوپر' %}super
                                 {% else %}lpg{% endif %}
                                 {% if nozzle.status == 1 %}payment-working
                                 {% elif nozzle.status == 2 %}payment-faulty
                                 {% else %}payment-none{% endif %}"
                                 onclick="showNozzleInfo(
                                    '{{ sakoo }}',
                                    '{{ tolombe }}',
                                    '{{ nozzle.product }}',
                                    '{{ nozzle.status }}',
                                    '{{ nozzle.number }}'
                                 )">
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
<button style="font-size: 30px" type="button"   onclick="window.history.back()">
                    بازگشت
                </button>
    <script>
        function showNozzleInfo(platform, pump, product, statusId, number) {

            const statusText = {
                '1': 'فعال (PT روشن)',
                '2': 'معیوب',
                '3': 'فاقد سم یا تجهیزات سامانه',
                '4': 'خارج از سرویس',
                '5': 'فاقد فروش'
            };

            document.getElementById('info-platform').textContent = platform;
            document.getElementById('info-pump').textContent = pump;
            document.getElementById('info-product').textContent = product;
            document.getElementById('info-status').textContent = statusText[statusId] || 'نامشخص';
            document.getElementById('info-nozzle-number').textContent = number || 'نامشخص';

            document.getElementById('nozzle-info').style.display = 'block';
        }

        // بستن پنجره با کلیک خارج از آن
        document.addEventListener('click', function(e) {
            const infoWindow = document.getElementById('nozzle-info');
            if (e.target.closest('.nozzle') || e.target.closest('.close-btn')) {
                return;
            }
            infoWindow.style.display = 'none';
        });
    </script>
</body>
</html>
{% load static %}
<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="{% static 'assets/verify/style.css' %}" />

<title>Verification Account UI</title>
</head>
<body>
{% include 'message.html' %}
  <div class="container">
    <h2>کد تایید به شماره {{ mobail|safe|slice:"9:13" }}******* ارسال شد</h2>
    <p class="text-primary">
      در صورت عدم دریافت پیامک ، شماره موبایل خود را به رئیس سامانه هوشمند سوخت منطقه ارائه کنید
    </p>

    <div class="code-container">
      <input id="code1" type="number" class="code" placeholder="0" min="0" max="9" required>
      <input id="code2" type="number" class="code" placeholder="0" min="0" max="9" required>
      <input id="code3" type="number" class="code" placeholder="0" min="0" max="9" required>
      <input id="code4" type="number" class="code" placeholder="0" min="0" max="9" required>

    </div>
 <form id="frmsubmit" class="newsletter-form" data-toggle="validator" action="" method="post">
                                        {% csrf_token %}
                                        <div class="form-group">
                                            <input style="font-size: 25px"   id="id_code"  type="hidden" class="input-newsletter text-danger" placeholder="کد پیامک شده" name="code" required autocomplete="off">
                                        </div>  
    <div>
      <button onclick="id_submit_Form()" type="button" class="btn btn-primary">تایید و ادامه</button>
    </div>
 </form>
    <h3 class="info">
            <div id="timer" class="flex-wrap d-flex justify-content-center">

                                    <div id="app" class="align-items-center flex-column d-flex justify-content-center"> </div>

                                </div>
      <div id="validator-newsletter" class="form-result"></div>
    </h3>

  </div>

<script src="{% static 'assets/verify/script.js' %}"></script>
</body>
</html>



<script>
    function id_submit_Form() {
        var code1= document.getElementById('code1').value
        var code2= document.getElementById('code2').value
        var code3= document.getElementById('code3').value
        var code4= document.getElementById('code4').value
        document.getElementById('id_code').value = code1+code2+code3+code4
        document.getElementById('frmsubmit').submit()
    }
   function myFunction() {

       if ( document.getElementById('id_code').value.length === 4) {
           waiting()
        document.getElementById('btnsubmit').click()
       }
   }
    const FULL_DASH_ARRAY = 283;
    const WARNING_THRESHOLD = 10;
    const ALERT_THRESHOLD = 5;

    const COLOR_CODES = {
      info: {
        color: "green"
      },
      warning: {
        color: "orange",
        threshold: WARNING_THRESHOLD
      },
      alert: {
        color: "red",
        threshold: ALERT_THRESHOLD
      }
    };

    const TIME_LIMIT = {{ ttl }};
    let timePassed = 0;
    let timeLeft = TIME_LIMIT;
    let timerInterval = null;
    let remainingPathColor = COLOR_CODES.info.color;

    document.getElementById("app").innerHTML = `
<span>  اعتبار </span>
      <span id="base-timer-label">${formatTime(
        timeLeft
      )}</span>

    `;

    startTimer();

    function onTimesUp() {
      clearInterval(timerInterval);
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timePassed = timePassed += 1;
        timeLeft = TIME_LIMIT - timePassed;
        document.getElementById("base-timer-label").innerHTML = formatTime(
          timeLeft
        );
        setCircleDasharray();
        setRemainingPathColor(timeLeft);

        if (timeLeft === 0) {
          onTimesUp();
        }
      }, 1000);
    }

    function formatTime(time) {
      const minutes = Math.floor(time / 60);
      let seconds = time % 60;

      if (seconds < 10) {
        seconds = `0${seconds}`;
      }

      return `${minutes}:${seconds}`;
    }

    function setRemainingPathColor(timeLeft) {
      const { alert, warning, info } = COLOR_CODES;
      if (timeLeft <= alert.threshold) {
        document
          .getElementById("base-timer-path-remaining")
          .classList.remove(warning.color);
        document
          .getElementById("base-timer-path-remaining")
          .classList.add(alert.color);
      } else if (timeLeft <= warning.threshold) {
        document
          .getElementById("base-timer-path-remaining")
          .classList.remove(info.color);
        document
          .getElementById("base-timer-path-remaining")
          .classList.add(warning.color);
      }
    }

    function calculateTimeFraction() {
      const rawTimeFraction = timeLeft / TIME_LIMIT;
      return rawTimeFraction - (1 / TIME_LIMIT) * (1 - rawTimeFraction);
    }

    function setCircleDasharray() {
      const circleDasharray = `${(
        calculateTimeFraction() * FULL_DASH_ARRAY
      ).toFixed(0)} 283`;
      document
        .getElementById("base-timer-path-remaining")
        .setAttribute("stroke-dasharray", circleDasharray);
    }

    </script>

<script>

function MySite(){
 window.location.href="{% url  'base:login' %}";
}

setTimeout(MySite, {{ expire_page }});

</script>
